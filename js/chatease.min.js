chatease=function(){if(chatease.api)return chatease.api.getInstance.apply(this,arguments)};chatease.version="1.0.13";
(function(b){function f(a){return null!==navigator.userAgent.toLowerCase().match(a)}var d=b.utils={};d.exists=function(a){switch(d.typeOf(a)){case "string":return 0<a.length;case "object":return null!==a;case "null":return!1}return!0};d.extend=function(){var a=Array.prototype.slice.call(arguments,0),c=a[0];if(1<a.length)for(var e=1;e<a.length;e++)d.foreach(a[e],function(a,e){void 0!==e&&null!==e&&(c[a]=e)});return c};d.foreach=function(a,c){for(var e in a)a.hasOwnProperty&&"function"===d.typeOf(a.hasOwnProperty)?
a.hasOwnProperty(e)&&c(e,a[e]):c(e,a[e])};d.getCookie=function(a){var c;return(c=document.cookie.match(new RegExp("(^| )"+a+"=([^;]*)(;|$)")))?unescape(c[2]):null};d.formatTime=function(a){var c=a.getHours()+1,e=a.getMinutes(),b=a.getSeconds();return a.toLocaleDateString()+" "+d.pad(c,2)+":"+d.pad(e,2)+":"+d.pad(b,2)};d.pad=function(a,c){for(a+="";a.length<c;)a="0"+a;return a};d.typeOf=function(a){if(null===a||void 0===a)return"null";var c=typeof a;if("object"===c)try{var e=toString.call(a).match(/^\[object ([a-z]+)\]$/i);
if(e&&1<e.length&&e[1])return e[1].toLowerCase()}catch(k){}return c};d.isInt=function(a){return 0===parseFloat(a)%1};d.trim=function(a){return a.replace(/^\s+|\s+$/g,"")};d.indexOf=function(a,c){if(null==a)return-1;for(var e=0;e<a.length;e++)if(a[e]===c)return e;return-1};d.createElement=function(a,c){a=document.createElement(a);c&&(a.className=c);return a};d.addClass=function(a,c){var e="string"===d.typeOf(a.className)?a.className.split(" "):[];c="array"===d.typeOf(c)?c:c.split(" ");d.foreach(c,
function(a,c){-1===d.indexOf(e,c)&&e.push(c)});a.className=d.trim(e.join(" "))};d.removeClass=function(a,c){var e="string"===d.typeOf(a.className)?a.className.split(" "):[];c="array"===d.typeOf(c)?c:c.split(" ");d.foreach(c,function(a,c){a=d.indexOf(e,c);0<=a&&e.splice(a,1)});a.className=d.trim(e.join(" "))};d.emptyElement=function(a){for(;a.firstChild;)a.removeChild(a.firstChild)};d.isMSIE=function(a){return a?(a=parseFloat(a).toFixed(1),f(new RegExp("msie\\s*"+a,"i"))):f(/msie/i)};d.isSafari=function(){return f(/safari/i)&&
!f(/chrome/i)&&!f(/chromium/i)&&!f(/android/i)};d.isIOS=function(a){return a?f(new RegExp("iP(hone|ad|od).+\\sOS\\s"+a,"i")):f(/iP(hone|ad|od)/i)};d.isAndroid=function(a,c){return c&&f(/chrome\/[123456789]/i)&&!f(/chrome\/18/)?!1:a?(d.isInt(a)&&!/\./.test(a)&&(a=""+a+"."),f(new RegExp("Android\\s*"+a,"i"))):f(/Android/i)};d.isMobile=function(){return d.isIOS()||d.isAndroid()};d.getProtocol=function(a){var c="http";(a=a.match(/^([a-z]+)\:\/\//i))&&1<a.length&&(c=a[1]);return c};d.getFileName=function(a){var c=
"";(a=a.match(/\/([a-z0-9\(\)\[\]\{\}\s\-_%]*(\.[a-z0-9]+)?)$/i))&&1<a.length&&(c=a[1]);return c};d.getExtension=function(a){var c="";(a=a.match(/\/?([a-z0-9\(\)\[\]\{\}\s\-_%]*(\.([a-z0-9]+))*)\??([a-z0-9\-_%&=]*)$/i))&&3<a.length&&(c=a[3]);return c};var g=window.console=window.console||{log:function(){}};d.log=function(){var a=Array.prototype.slice.call(arguments,0);"object"===d.typeOf(g.log)?g.log(a):g.log.apply(g,a)}})(chatease);
(function(b){var f=b.utils;b=f.crypt={};b.stringToByteArray=function(d){for(var b=[],a=0,c=0;c<d.length;c++){for(var e=d.charCodeAt(c);255<e;)b[a++]=e&255,e>>=8;b[a++]=e}return b};b.byteArrayToString=function(d){if(8192>=d.length)return String.fromCharCode.apply(null,d);for(var b="",a=0;a<d.length;a+=8192)var c=Array.slice(d,a,a+8192),b=b+String.fromCharCode.apply(null,c);return b};b.byteArrayToHex=function(d){return Array.map(d,function(d){d=d.toString(16);return 1<d.length?d:"0"+d}).join("")};b.hexToByteArray=
function(d){if(0!==d.length%2)return f.log("Key string length must be multiple of 2."),null;for(var b=[],a=0;a<d.length;a+=2)b.push(parseInt(d.substring(a,a+2),16));return b};b.stringToUTF8ByteArray=function(d){for(var b=[],a=0,c=0;c<d.length;c++){var e=d.charCodeAt(c);128>e?b[a++]=e:(2048>e?b[a++]=e>>6|192:(55296==(e&64512)&&c+1<d.length&&56320==(d.charCodeAt(c+1)&64512)?(e=65536+((e&1023)<<10)+(d.charCodeAt(++c)&1023),b[a++]=e>>18|240,b[a++]=e>>12&63|128):b[a++]=e>>12|224,b[a++]=e>>6&63|128),b[a++]=
e&63|128)}return b};b.UTF8ByteArrayToString=function(d){for(var b=[],a=0,c=0;a<d.length;){var e=d[a++];if(128>e)b[c++]=String.fromCharCode(e);else if(191<e&&224>e){var f=d[a++];b[c++]=String.fromCharCode((e&31)<<6|f&63)}else if(239<e&&365>e){var f=d[a++],h=d[a++],t=d[a++],e=((e&7)<<18|(f&63)<<12|(h&63)<<6|t&63)-65536;b[c++]=String.fromCharCode(55296+(e>>10));b[c++]=String.fromCharCode(56320+(e&1023))}else f=d[a++],h=d[a++],b[c++]=String.fromCharCode((e&15)<<12|(f&63)<<6|h&63)}return b.join("")};b.XORByteArray=
function(d,b){if(d.length!==b.length)f.log("XOR array lengths must match.");else{for(var a=[],c=0;c<d.length;c++)a.push(d[c]^b[c]);return a}}})(chatease);
(function(b){function f(){var a=document.createElement("style");a.type="text/css";document.getElementsByTagName("head")[0].appendChild(a);return a.sheet||a.styleSheet}var d=b.utils,g;(d.css=function(a,c){g||(g=f());var e="";d.foreach(c,function(a,c){e+=a+": "+c+"; "});try{g.insertRule?g.insertRule(a+" { "+e+"}",g.cssRules.length):g.addRule(a,e,g.rules.length)}catch(k){d.log("Failed to insert css rule: "+a)}}).style=function(a,c,e){if(void 0!==a&&null!==a)for(void 0===a.length&&(a=[a]),c=d.extend({},
c),e=0;e<a.length;e++){var b=a[e];void 0!==b&&null!==b&&d.foreach(c,function(a,c){a=a.split("-");for(var e=1;e<a.length;e++)a[e]=a[e].charAt(0).toUpperCase()+a[e].slice(1);a=a.join("");b.style[a]!==c&&(b.style[a]=c)})}}})(chatease);(function(b){var f=b.utils;f.filter=function(b){var d,a="";this.replace=function(c){return a&&d?c.replace(d,"**"):c};"string"==f.typeOf(b)&&b&&(a=b,d=new RegExp(a,"ig"))}})(chatease);
(function(b){b.events={ERROR:"error",CHATEASE_READY:"chateaseReady",CHATEASE_SETUP_ERROR:"chateaseSetupError",CHATEASE_RENDER_ERROR:"chateaseRenderError",CHATEASE_STATE:"chateaseState",CHATEASE_PROPERTY:"chateaseProperty",CHATEASE_CONNECT:"chateaseConnect",CHATEASE_INDENT:"chateaseIdent",CHATEASE_MESSAGE:"chateaseMessage",CHATEASE_JOIN:"chateaseJoin",CHATEASE_LEFT:"chateaseLeft",CHATEASE_USERS:"chateaseUsers",CHATEASE_CLOSE:"chateaseClose",CHATEASE_VIEW_SEND:"chateaseViewSend",CHATEASE_VIEW_PROPERTY:"chateaseViewProperty",
CHATEASE_VIEW_CLEARSCREEN:"chateaseViewClearScreen",CHATEASE_VIEW_NICKCLICK:"chateaseViewNickClick"}})(chatease);
(function(b){var f=b.utils;b.events.eventdispatcher=function(d){function g(a,c,b){if(a)for(var e=0;e<a.length;e++){var d=a[e];if(d){null!==d.count&&0===--d.count&&delete a[e];try{d.listener(c)}catch(n){f.log('Error handling "'+b+'" event listener ['+e+"]: "+n.toString(),d.listener,c)}}}}var a={},c=[];this.addEventListener=function(c,b,d){try{f.exists(a[c])||(a[c]=[]),"string"===f.typeOf(b)&&(b=(new Function("return "+b))()),a[c].push({listener:b,count:d||null})}catch(t){f.log("error",t)}return!1};
this.removeEventListener=function(c,b){if(a[c]){try{if(void 0===b){a[c]=[];return}var d;for(d=0;d<a[c].length;d++)if(a[c][d].listener.toString()===b.toString()){a[c].splice(d,1);break}}catch(t){f.log("error",t)}return!1}};this.addGlobalListener=function(a,b){try{"string"===f.typeOf(a)&&(a=(new Function("return "+a))()),c.push({listener:a,count:b||null})}catch(h){f.log("error",h)}return!1};this.removeGlobalListener=function(a){if(a){try{var b;for(b=c.length-1;0<=b;b--)c[b].listener.toString()===a.toString()&&
c.splice(b,1)}catch(h){f.log("error",h)}return!1}};this.dispatchEvent=function(e,k){k||(k={});f.extend(k,{id:d,version:b.version,type:e});b.debug&&f.log(e,k);g(a[e],k,e);g(c,k,e)}}})(chatease);
(function(b){var f=b.utils,d=b.events,g={},a={onError:d.ERROR,onReady:d.CHATEASE_READY,onConnect:d.CHATEASE_CONNECT,onIdent:d.CHATEASE_INDENT,onMessage:d.CHATEASE_MESSAGE,onJoin:d.CHATEASE_JOIN,onLeft:d.CHATEASE_LEFT,onUsers:d.CHATEASE_USERS,onNickClick:d.CHATEASE_VIEW_NICKCLICK,onClose:d.CHATEASE_CLOSE};b.api=function(c){function e(a){k.dispatchEvent(a.type,a)}var k=f.extend(this,new d.eventdispatcher("api")),g;k.container=c;k.id=c.id;k.setup=function(a){f.emptyElement(k.container);b.debug=!!a.debug;
k.config=a;k.config.id=k.id;k.embedder=new b.embed(k);k.embedder.addGlobalListener(e);k.embedder.embed();return k};k.setEntity=function(a,c){g=a;k.onSWFLoaded=g.setup;k.onSWFOpen=g.onSWFOpen;k.onSWFMessage=g.onSWFMessage;k.onSWFError=g.onSWFError;k.onSWFClose=g.onSWFClose;k.send=g.send;k.resize=g.resize};(function(){f.foreach(a,function(a,c){k[a]=function(a){k.addEventListener(c,a)}})})()};b.api.getInstance=function(a){var c;null==a?a=0:a.nodeType?c=a:"string"===f.typeOf(a)&&(c=document.getElementById(a));
if(c){var d=g[c.id];d||(g[a]=d=new b.api(c));return d}return"number"===f.typeOf(a)?g[a]:null};b.api.displayError=function(a,b){}})(chatease);(function(b){b.core={}})(chatease);(function(b){b.core.states={CONNECTED:"connected",CLOSED:"closed",ERROR:"error"}})(chatease);
(function(b){b.core.protocol={};b=b.core.protocol;b.cmds={TEXT:"text",MUTE:"mute",KICKOUT:"kickout",PING:"ping"};b.raws={IDENT:"ident",TEXT:"text",JOIN:"join",LEFT:"left",USERS:"users",MUTE:"mute",KICKOUT:"kickout",ERROR:"error",PONG:"pong"};b.roles={VISITOR:0,NORMAL:1,VIP:14,ASSISTANT:16,SECRETARY:32,ANCHOR:48,ADMIN:64,SU_ADMIN:128,SYSTEM:192};b.channelStates={NORMAL:0,MUTED:1,LOCKED:3};b.punishments={MUTED:1,KICKED_OUT:3};b.errors={BAD_REQUEST:400,UNAUTHORIZED:401,FORBIDDED:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,
REQUEST_TIMEOUT:408,CONFLICT:409,INTERNAL_SERVER_ERROR:500,NOT_IMPLEMENTED:501,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504}})(chatease);(function(b){b.core.skins={}})(chatease);(function(b){b.core.skins.modes={DEFAULT:"def"}})(chatease);
(function(b){var f=b.utils,d=b.events;b=b.core.skins;var g=b.modes,a=f.css,c="cha-skin";b.def=function(b){var e=f.extend(this,new d.eventdispatcher("skins.def"));e.resize=function(c,b){c=document.getElementById(e.config.id);b=document.getElementById(e.config.id+"-console");var d=document.getElementById(e.config.id+"-input");a.style(b,{height:c.clientHeight-140+"px"});a.style(d,{width:c.clientWidth-96+"px"})};e.name=g.DEFAULT;e.config=f.extend({},b);c+="-"+e.name;a(".cha-wrapper",{width:"100%",height:"100%"});
a(".cha-wrapper *",{margin:"0",padding:"0","font-family":"Microsoft YaHei,arial,sans-serif","font-size":"14px","font-weight":"normal","box-sizing":"content-box"});a("."+c+" .cha-checkbox",{padding:"6px 0 6px 18px",color:"#E6E6E6","background-repeat":"no-repeat","background-position":"left center",cursor:"pointer",overflow:"hidden"});a("."+c+" .cha-button",{padding:"6px 14px","font-style":"normal","font-weight":"normal","text-align":"center","text-transform":"uppercase","white-space":"nowrap","word-spacing":"normal",
border:"none","border-radius":"2px",cursor:"pointer",display:"inline-block","-webkit-font-smoothing":"subpixel-antialiased","-moz-osx-font-smoothing":"grayscale",transition:"150ms ease-in-out","transition-property":"background-color, color"});a("."+c+" .cha-button.red",{color:"#FFFFFF","background-color":"#FF0046"});a("."+c+" .cha-button.red:hover",{"background-color":"#97052D"});a("."+c+" .cha-render",{width:"100%",height:"100%"});a("."+c+" .cha-render .cha-title",{width:"100%",height:"40px","font-family":"inherit",
"font-weight":"normal","text-align":"center","line-height":"40px",color:"#E6E6E6","background-color":"#171717",cursor:"default","pointer-events":"none"});a("."+c+" .cha-render .cha-console",{height:e.config.height-140+"px",color:"#242424","background-color":"#F8F8F8","overflow-y":"scroll"});a("."+c+" .cha-render .cha-console > div",{margin:"6px","word-break":"break-all","word-wrap":"break-word"});a("."+c+" .cha-render .cha-console > div.cha-system, ."+c+" .cha-render .cha-console > div.cha-system > a",
{"font-style":"normal","font-weight":"normal",color:"#33CC00",cursor:"default","pointer-events":"none"});a("."+c+" .cha-render .cha-console > div > span.ico-visitor",{"margin-right":"6px"});a("."+c+" .cha-render .cha-console > div > span.ico-normal",{"margin-right":"6px"});a("."+c+" .cha-render .cha-console > div > a",{color:"#3C9CFE","text-decoration":"none",cursor:"pointer"});a("."+c+" .cha-render .cha-controls",{width:"100%",height:"40px","line-height":"100%","background-color":"#171717",overflow:"hidden"});
a("."+c+" .cha-render .cha-controls > *",{margin:"6px 0","text-align":"center",display:"block"});a("."+c+" .cha-render .cha-controls > .cha-checkbox",{"background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOAgMAAABiJsVCAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAJUExURUxpcebm5ubm5kbBEu0AAAACdFJOUwCgoEVu0AAAABpJREFUCNdjYAABqVWrHBi0Vq1qII0AawMBACnPF0kf/g8sAAAAAElFTkSuQmCC)"});a("."+c+" .cha-render .cha-controls > .cha-checkbox[checked=true]",{"background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAA40lEQVQ4T52SvXHCQBCF3wuUKDHp7QXYFZgOrBKgAqADOsDuRK7ALoEOGDqwk1UoSHSBZrTMMWhGY358w0YbvG9/3i7xYDByqloCmKfUMLPSe7/sQUuADmfNk4gwCTSzXZZli7ZtS5KvSWCE8jwvmqZZkVzHrv+CPRRCKAB89etcA38BjM+CA8lJzLuu25Ic3QJ/RORl4PBMRL5VdQPgbWjeRUcz+/Dev1dVVTjnNqo6HY54b1SQXDrnyrquRyGELYDnv6e6Z87MzCa9i8mgme2jeGjIrR2TXw7Ap4gsTp/zSBwBq1l6D5ci9L8AAAAASUVORK5CYII=)"});
a("."+c+" .cha-render .cha-controls .shieldtext",{"float":"left"});a("."+c+" .cha-render .cha-controls .clearscreen",{"float":"right",width:"42px"});a("."+c+" .cha-render .cha-dialog",{width:"100%",height:"60px",overflow:"hidden"});a("."+c+" .cha-render .cha-dialog textarea",{padding:"6px 10px",width:e.config.width-124+"px",height:"48px",resize:"none",border:"0 none","background-color":"#E6E6E6"});a("."+c+" .cha-render .cha-dialog button",{"float":"right",width:"42px",height:"48px"})}})(chatease);
(function(b){b.core.renders={}})(chatease);(function(b){b.core.renders.modes={DEFAULT:"def"}})(chatease);
(function(b){var f=b.utils,d=b.events;b=b.core;var g=b.protocol.roles;b=b.renders;var a=b.modes;b.def=function(c,b){function e(a,c,b,d,e){var g=f.createElement("div",c);g.setAttribute("checked",!!e);g.innerHTML=a;a=function(a,c){return function(b){b="true"==g.getAttribute("checked")?!1:!0;g.setAttribute("checked",b);l.dispatchEvent(a,f.extend({value:b},c))}}(b,d);try{g.addEventListener("click",a)}catch(z){g.attachEvent("onclick",a)}return g}function h(a,c,b,d){c=f.createElement("div",c);var e=f.createElement("a");
c.appendChild(e);e.innerHTML=a;a=function(a,c){return function(b){l.dispatchEvent(a,c)}}(b,d);try{e.addEventListener("click",a)}catch(y){e.attachEvent("onclick",a)}return c}function t(a){var c="";return"number"!=f.typeOf(a)&&(a=parseInt(a),NaN==a||0>a)?"":c=a&g.SYSTEM?(a&g.SYSTEM)==g.SYSTEM?c+"ico-system":a&g.SU_ADMIN?c+"ico-suadmin":c+"ico-admin":a&g.ANCHOR?(a&g.ANCHOR)==g.ANCHOR?c+"ico-anchor":a&g.SECRETARY?c+"ico-secretary":c+"ico-assistant":a&g.VIP?c+("ico-vip"+((a&g.VIP)-1)):(a&g.NORMAL)==g.NORMAL?
c+"ico-normal":c+"ico-visitor"}var l=f.extend(this,new d.eventdispatcher("renders.def")),n,p,w,x,m,u;l.setup=function(){f.isMSIE(8)||f.isMSIE(9)?_object.setup&&(l.config.debug=!0,_object.setup(l.config),l.dispatchEvent(d.CHATEASE_READY,{id:l.config.id})):l.dispatchEvent(d.CHATEASE_READY,{id:l.config.id})};l.show=function(a,c,b){"object"!=f.typeOf(c)&&(c={id:0,name:"\u7cfb\u7edf",role:g.SYSTEM});"uni"!=b&&(b="multi");var e=f.createElement("div");c.role&g.SYSTEM&&(e.className="cha-system");"uni"==b&&
(b=f.createElement("span"),b.innerHTML="[\u5bc6\u8bed]",e.appendChild(b));if(b=t(c.role))b=f.createElement("span",b),e.appendChild(b);b=f.createElement("a");b.innerHTML=c.name+"\uff1a";c=function(a){return function(c){l.dispatchEvent(d.CHATEASE_VIEW_NICKCLICK,{user:a})}}(c);try{b.addEventListener("click",c)}catch(r){b.attachEvent("onclick",c)}e.appendChild(b);e.insertAdjacentHTML("beforeend",a);p.childNodes.length>=l.config.maxrecords&&p.removeChild(p.childNodes[0]);p.appendChild(e);p.scrollTop=p.scrollHeight};
l.send=function(){l.dispatchEvent(d.CHATEASE_VIEW_SEND,{data:{data:m.value,type:"multi"}});l.clearInput()};l.clearInput=function(){m.value=""};l.clearScreen=function(){f.emptyElement(p)};l.element=function(){return _object};l.resize=function(a,c){};l.destroy=function(){};l.name=a.DEFAULT;l.config=f.extend({},{},b);if(f.isMSIE(8)||f.isMSIE(9))c.innerHTML='<object id="cha-swf" name="cha-swf" align="middle" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"><param name="movie" value="'+l.config.swf+
'"><param name="quality" value="high"><param name="bgcolor" value="#ffffff"><param name="allowscriptaccess" value="sameDomain"><param name="allowfullscreen" value="true"><param name="wmode" value="transparent"><param name="FlashVars" value="id='+l.config.id+'"></object>',_object=l.WebSocket=c.firstChild,_object.style.width=_object.style.height="0";(function(){n=f.createElement("div","cha-title");c.appendChild(n);n.innerHTML="\u804a\u5929\u5ba4";p=f.createElement("div","cha-console");p.id=l.config.id+
"-console";c.appendChild(p);w=f.createElement("div","cha-controls");c.appendChild(w);var a=e("\u5c4f\u853d\u6d88\u606f","cha-checkbox shieldtext",d.CHATEASE_VIEW_PROPERTY,{key:"shield"},!1);w.appendChild(a);a=h("\u6e05\u5c4f","cha-button red clearscreen",d.CHATEASE_VIEW_CLEARSCREEN,null);w.appendChild(a);x=f.createElement("div","cha-dialog");c.appendChild(x);m=f.createElement("textarea");m.id=l.config.id+"-input";x.appendChild(m);u=f.createElement("button","cha-button red");x.appendChild(u);m.setAttribute("placeholder",
"\u8f93\u5165\u804a\u5929\u5185\u5bb9");l.config.maxlength&&m.setAttribute("maxlength",l.config.maxlength);a=function(){return function(a){a=window.event||a;13==a.keyCode&&(a.ctrlKey?m.value+="\r\n":(l.send(),window.event?a.returnValue=!1:a.preventDefault()))}}();try{m.addEventListener("keypress",a)}catch(v){m.attachEvent("onkeypress",a)}u.innerHTML="\u53d1\u9001";a=function(){return function(){l.send()}}();try{u.addEventListener("click",a)}catch(v){u.attachEvent("onclick",a)}})()}})(chatease);
(function(b){var f=b.utils,d=b.events,g=b.core;g.entity=function(a){var c=f.extend(this,new d.eventdispatcher("core.entity")),b,k,h;c.setup=function(){setTimeout(function(){h.setup()},0)};c.destroy=function(){h&&h.stop();k&&k.destroy();b&&b.destroy()};c.id=a.id;c.model=b=new g.model(a);c.view=k=new g.view(b);c.controller=h=new g.controller(b,k);h.addGlobalListener(function(a){c.dispatchEvent(a.type,a)});c.onSWFOpen=h.onOpen;c.onSWFMessage=h.onMessage;c.onSWFError=h.onError;c.onSWFClose=h.onClose;
c.send=h.send;c.getState=b.getState;c.resize=k.resize}})(chatease);
(function(b){var f=b.utils,d=b.events;b=b.core;var g=b.states,a=b.protocol,c=a.roles,e=a.channelStates,k=a.punishments,h=function(){var a=this;_interval=-1;_active=0;a.set=function(b){f.extend(a,b);1==b.hasOwnProperty("role")&&(b=b.role,_interval=0>b?-1:b>=c.ASSISTANT?0:b&c.VIP?500:b==c.NORMAL?1E3:2E3)};a.isMuted=function(){return!!(a.state&e.MUTED|a.punishment.code&k.MUTED)};a.isActive=function(){if(0>_interval)return!1;var a=(new Date).getTime();if(_active&&a-_active<_interval)return!1;_active=
a;return!0};f.extend(a,{channel:null,role:-1,state:0,punishment:{code:0,time:0}})};b.model=function(a){var c=f.extend(this,new d.eventdispatcher("core.model")),b=g.CLOSED,e;c.setState=function(a){a!==b&&(b=a,c.dispatchEvent(d.CHATEASE_STATE,{state:a}))};c.getState=function(){return b};c.setProperty=function(a,b){1==e.hasOwnProperty(a)&&(e[a]=b,c.dispatchEvent(d.CHATEASE_PROPERTY,{key:a,value:b}))};c.getProperty=function(a){return e[a]};c.getConfig=function(a){return c.config[a]};c.destroy=function(){};
c.config=f.extend({},{},a);e={userinfo:new h,shield:!1}}})(chatease);
(function(b){var f=b.utils,d=b.events;b=b.core;var g=b.protocol.roles,a=b.renders,c=b.skins;b.view=function(b){function e(a){if(a.ctrlKey||a.metaKey)return!0;switch(a.keyCode){case 13:m&&m.send()}if(/13|32/.test(a.keyCode))return a.preventDefault?a.preventDefault():a.returnValue=!1,!1}function h(a){n.resize()}function t(a){l(a)}function l(a){n.dispatchEvent(a.type,a)}var n=f.extend(this,new d.eventdispatcher("core.view")),p,w,x,m,u;n.setup=function(){m?(m.setup(),n.resize()):n.dispatchEvent(d.CHATEASE_SETUP_ERROR,
{message:"Render not available!",name:b.config.render.name})};n.show=function(a,c,d){(!c||c.role&g.SYSTEM||!b.getProperty("shield"))&&m&&m.show(a,c,d)};n.resize=function(a,b){m&&m.resize(a,b);u&&u.resize(a,b)};n.destroy=function(){p&&p.removeEventListener("keydown",e);m&&m.destroy()};(function(){p=f.createElement("div","cha-wrapper cha-skin-"+b.getConfig("skin").name);p.id=b.getConfig("id");p.tabIndex=0;w=f.createElement("div","cha-render");x=f.createElement("div","cha-contextmenu");p.appendChild(w);
p.appendChild(x);var g=f.extend({},b.getConfig("render"),{id:b.getConfig("id"),url:b.getConfig("url"),width:b.getConfig("width"),height:b.getConfig("height"),maxlength:b.getConfig("maxlength"),maxrecords:b.getConfig("maxrecords")});try{m=n.render=new a[g.name](w,g),m.addEventListener(d.CHATEASE_READY,l),m.addEventListener(d.CHATEASE_VIEW_SEND,l),m.addEventListener(d.CHATEASE_VIEW_PROPERTY,l),m.addEventListener(d.CHATEASE_VIEW_CLEARSCREEN,l),m.addEventListener(d.CHATEASE_VIEW_NICKCLICK,l),m.addEventListener(d.CHATEASE_RENDER_ERROR,
t)}catch(v){f.log("Failed to init render "+g.name+"!")}g=f.extend({},b.getConfig("skin"),{id:b.getConfig("id"),width:b.config.width,height:b.config.height});try{u=new c[g.name](g)}catch(v){f.log("Failed to init skin "+g.name+"!")}g=document.getElementById(b.getConfig("id"));g.parentNode.replaceChild(p,g);try{p.addEventListener("keydown",e),window.addEventListener("resize",h)}catch(v){p.attachEvent("onkeydown",e),window.attachEvent("onresize",h)}})()}})(chatease);
(function(b){var f=b.utils,d=f.crypt,g=b.events;b=b.core;var a=b.states,c=b.protocol,e=c.cmds,k=c.raws,h=c.roles,t=c.channelStates,l=c.punishments,n=c.errors;b.controller=function(b,c){function p(){if(r&&b.getState()==a.CONNECTED)f.log("Websocket had connected already.");else{c.show("\u804a\u5929\u5ba4\u8fde\u63a5\u4e2d\u2026");try{window.WebSocket=window.WebSocket||window.MozWebSocket,window.WebSocket?(r||(r=new WebSocket(b.config.url,"binary"),r.binaryType="arraybuffer"),r.onopen=q.onOpen,r.onmessage=
q.onMessage,r.onerror=q.onError,r.onclose=q.onClose):(r=c.render.WebSocket,r.connect())}catch(C){f.log("Failed to initialize websocket: "+C)}}}function m(a){var b="";if("number"!=f.typeOf(a)&&(a=parseInt(a),NaN==a||0>a))return"";a&h.SYSTEM?b=(a&h.SYSTEM)==h.SYSTEM?b+"[\u7cfb\u7edf]":a&h.SU_ADMIN?b+"[\u8d85\u7ba1]":b+"[\u7ba1\u7406\u5458]":a&h.ANCHOR?b=(a&h.ANCHOR)==h.ANCHOR?b+"[\u4e3b\u64ad]":a&h.SECRETARY?b+"[\u52a9\u7406]":b+"[\u623f\u7ba1]":a&h.VIP?b+="[VIP"+((a&h.VIP)-1)+"]":(a&h.NORMAL)!=h.NORMAL&&
(b+="[\u6e38\u5ba2]");return b}function u(a,b){var d=w(a);d&&c.show(d);var e={raw:"error",error:{code:a,explain:d}};f.foreach(b,function(a,b){"cmd"!=a&&"raw"!=a&&"error"!=a&&(e[a]=b)});q.dispatchEvent(g.ERROR,e)}function w(a){var b="";switch(a){case n.BAD_REQUEST:b="\u9519\u8bef\u8bf7\u6c42\uff01";break;case n.UNAUTHORIZED:b="\u8bf7\u5148\u767b\u5f55\uff01";break;case n.FORBIDDED:b="\u6743\u9650\u9519\u8bef\uff01";break;case n.NOT_FOUND:b="\u672a\u77e5\u8bf7\u6c42\uff01";break;case n.CONFLICT:b="\u64cd\u4f5c\u9891\u7e41\uff01";
break;case n.INTERNAL_SERVER_ERROR:b="\u5185\u90e8\u9519\u8bef\uff01";break;case n.NOT_IMPLEMENTED:b="\u65e0\u6cd5\u8bc6\u522b\uff01";break;case n.BAD_GATEWAY:b="\u54cd\u5e94\u65e0\u6548\uff01";break;case n.SERVICE_UNAVAILABLE:b="\u670d\u52a1\u8fc7\u8f7d\uff01";break;case n.GATEWAY_TIMEOUT:b="\u7f51\u5173\u8d85\u65f6\uff01"}return b}function v(a){q.dispatchEvent(a.type,a)}var q=f.extend(this,new g.eventdispatcher("core.controller")),A=!1,r,y,z=0;q.setup=function(a){A||c.setup()};q.send=function(c){if(r&&
b.getState()==a.CONNECTED)if("object"!=f.typeOf(c)||0==c.hasOwnProperty("cmd"))u(n.BAD_REQUEST,c);else{var e=b.getProperty("userinfo");if(0==e.isActive())u(n.CONFLICT,c);else if(1==e.isMuted())u(n.FORBIDDED,c);else{c=JSON.stringify(c);try{var g=d.stringToUTF8ByteArray(c),k=new Uint8Array(g);r.send(k.buffer);return}catch(D){}try{r.send(c)}catch(D){}}}else p()};q.onOpen=function(c){b.setState(a.CONNECTED)};q.onMessage=function(a){var e=a.data;"arraybuffer"===f.typeOf(a.data)&&(e=new Uint8Array(a.data),
e=d.UTF8ByteArrayToString(e));var h;try{h=eval("("+e+")")}catch(B){f.log("Failed to parse JSON. \nError: "+B+"\ndata: "+a.data);return}switch(h.raw){case k.IDENT:a=b.getProperty("userinfo");a.set(f.extend({},h.user,{channel:h.channel.id,state:h.channel.state}));c.show("\u5df2\u52a0\u5165\u623f\u95f4\uff08"+a.channel+"\uff09\u3002");a.state&t.MUTED&&c.show("\u60a8\u6240\u5728\u7684\u7528\u6237\u7ec4\u4e0d\u80fd\u53d1\u8a00\uff01");a.punishment.code&l.MUTED&&(e=new Date,e.setTime(a.punishment.time),
c.show("\u60a8\u5df2\u88ab\u7981\u8a00\u81f3\uff08"+f.formatTime(e)+"\uff09\uff01"));q.dispatchEvent(g.CHATEASE_INDENT,h);break;case k.TEXT:try{y||(y=new f.filter(b.keywords)),h.data=y.replace(h.data)}catch(B){f.log("Failed to execute filter.")}c.show(h.data,h.user,h.type);q.dispatchEvent(g.CHATEASE_MESSAGE,h);break;case k.JOIN:a=m(h.user.role);c.show((a?a+" ":"")+h.user.name+" \u8fdb\u5165\u623f\u95f4\u3002");q.dispatchEvent(g.CHATEASE_JOIN,h);break;case k.LEFT:a=m(h.user.role);c.show((a?a+" ":"")+
h.user.name+" \u5df2\u79bb\u5f00\u3002");q.dispatchEvent(g.CHATEASE_LEFT,h);break;case k.USERS:q.dispatchEvent(g.CHATEASE_USERS,h);break;case k.ERROR:u(h.error.code,h);break;default:f.log("Unknown data type: "+h.raw+", ignored.")}};q.onError=function(c){b.setState(a.ERROR)};q.onClose=function(c){b.setState(a.CLOSED)};q.close=function(){r&&r.close()};b.addEventListener(g.CHATEASE_STATE,function(d){switch(d.state){case a.CONNECTED:c.show("\u804a\u5929\u5ba4\u5df2\u8fde\u63a5\u2026");z=0;q.dispatchEvent(g.CHATEASE_CONNECT);
break;case a.CLOSED:c.show("\u804a\u5929\u5ba4\u8fde\u63a5\u5df2\u65ad\u5f00\uff01");q.dispatchEvent(g.CHATEASE_CLOSE,{channel:{id:b.channel}});if(0>b.config.maxretries||z<b.config.maxretries)d=Math.ceil(b.config.retrydelay+5E3*Math.random()),c.show("\u6b63\u5728\u51c6\u5907\u91cd\u8fde\uff0c"+d/1E3+"\u79d2..."),z++,r=null,setTimeout(p,d);break;case a.ERROR:c.show("\u804a\u5929\u5ba4\u5f02\u5e38\uff01");q.dispatchEvent(g.ERROR,{message:"Chat room error!",channel:{id:b.channel}});break;default:q.dispatchEvent(g.ERROR,
{message:"Unknown model state!",state:d.state})}});b.addEventListener(g.CHATEASE_PROPERTY,function(a){v(a)});c.addEventListener(g.CHATEASE_READY,function(a){A||(f.log("Chat ready!"),A=!0,v(a),p(),window.onbeforeunload=function(a){r&&b.getState()})});c.addEventListener(g.CHATEASE_SETUP_ERROR,function(c){b.setState(a.ERROR);v(c)});c.addEventListener(g.CHATEASE_VIEW_SEND,function(a){var d=a.data.data;if(d){0<=b.config.maxlength&&(d=d.substr(0,b.config.maxlength));var d=f.trim(d),g=b.getProperty("userinfo");
q.send({cmd:e.TEXT,data:d,type:a.data.type,channel:{id:g.channel}})}else c.show("\u8bf7\u8f93\u5165\u5185\u5bb9\uff01")});c.addEventListener(g.CHATEASE_VIEW_PROPERTY,function(a){b.setProperty(a.key,a.value)});c.addEventListener(g.CHATEASE_VIEW_CLEARSCREEN,function(a){c.render.clearScreen();v(a)});c.addEventListener(g.CHATEASE_VIEW_NICKCLICK,function(a){var c=b.getProperty("userinfo");a.channel={id:c.channel,state:c.state};v(a)});c.addEventListener(g.CHATEASE_RENDER_ERROR,function(c){b.setState(a.ERROR);
v(c)})}})(chatease);
(function(b){var f=b.utils,d=b.events,g=b.embed=function(a){function c(a){switch(a.type){case d.ERROR:case d.CHATEASE_SETUP_ERROR:case d.CHATEASE_RENDER_ERROR:e.errorScreen(a.message);e.dispatchEvent(d.ERROR,a);break;default:e.dispatchEvent(a.type,a)}}var e=f.extend(this,new d.eventdispatcher("embed")),k={},h=null,t=!1;e.embed=function(){try{k=new g.config(a.config),h=new g.embedder(a,k)}catch(l){f.log("Failed to init embedder!");e.dispatchEvent(d.CHATEASE_SETUP_ERROR,{message:"Failed to init embedder!",render:k.render.name});
return}h.addGlobalListener(c);h.embed()};e.errorScreen=function(a){t||(t=!0,b.api.displayError(a,k))};(function(){f.foreach(a.config.events,function(b,c){b=a[b];"function"===f.typeOf(b)&&b.call(a,c)})})()}})(chatease);
(function(b){var f=b.utils,d=b.embed,g=b.core.renders.modes,a=b.core.skins.modes;d.config=function(b){return f.extend({},{url:"ws://"+window.location.host+"/ch1?token=123456",width:640,height:400,keywords:"",maxlength:30,maxrecords:50,maxretries:-1,retrydelay:3E3,render:{name:g.DEFAULT,swf:"swf/chatease.swf"},skin:{name:a.DEFAULT}},b)};d.config.addConfig=function(a,b){return f.extend(a,b)}})(chatease);
(function(b){var f=b.utils,d=b.events,g=b.core;b.embed.embedder=function(a,b){function c(a){k.dispatchEvent(a.type,a)}var k=f.extend(this,new d.eventdispatcher("embed.embedder"));k.embed=function(){var d=new g.entity(b);d.addGlobalListener(c);d.setup();a.setEntity(d,b.render.name)}}})(chatease);