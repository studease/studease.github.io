chatease=function(){if(chatease.api)return chatease.api.getInstance.apply(this,arguments)};chatease.version="1.0.10";
(function(b){var a=b.utils={};a.exists=function(c){switch(a.typeOf(c)){case "string":return 0<c.length;case "object":return null!==c;case "null":return!1}return!0};a.extend=function(){var c=Array.prototype.slice.call(arguments,0),d=c[0];if(1<c.length)for(var e=1;e<c.length;e++)a.foreach(c[e],function(c,a){void 0!==a&&null!==a&&(d[c]=a)});return d};a.foreach=function(c,d){for(var e in c)c.hasOwnProperty&&"function"===a.typeOf(c.hasOwnProperty)?c.hasOwnProperty(e)&&d(e,c[e]):d(e,c[e])};a.getCookie=
function(c){var a;return(a=document.cookie.match(new RegExp("(^| )"+c+"=([^;]*)(;|$)")))?unescape(a[2]):null};a.formatTime=function(c){var d=c.getHours()+1,e=c.getMinutes(),b=c.getSeconds();return c.toLocaleDateString()+" "+a.pad(d,2)+":"+a.pad(e,2)+":"+a.pad(b,2)};a.pad=function(c,a){for(c+="";c.length<a;)c="0"+c;return c};a.createElement=function(a,d){a=document.createElement(a);d&&(a.className=d);return a};a.addClass=function(c,d){var e="string"===a.typeOf(c.className)?c.className.split(" "):[];
d="array"===a.typeOf(d)?d:d.split(" ");a.foreach(d,function(c,d){-1===a.indexOf(e,d)&&e.push(d)});c.className=a.trim(e.join(" "))};a.removeClass=function(c,d){var e="string"===a.typeOf(c.className)?c.className.split(" "):[];d="array"===a.typeOf(d)?d:d.split(" ");a.foreach(d,function(c,d){c=a.indexOf(e,d);0<=c&&e.splice(c,1)});c.className=a.trim(e.join(" "))};a.emptyElement=function(a){for(;a.firstChild;)a.removeChild(a.firstChild)};a.typeOf=function(a){if(null===a||void 0===a)return"null";var c=typeof a;
if("object"===c)try{if("[object Array]"===toString.call(a))return"array"}catch(e){}return c};a.trim=function(a){return a.replace(/^\s+|\s+$/g,"")};a.indexOf=function(a,d){if(null==a)return-1;for(var c=0;c<a.length;c++)if(a[c]===d)return c;return-1};a.isMSIE=function(a){return a?(a=parseFloat(a).toFixed(1),a=new RegExp("msie\\s*"+a,"i"),null!==navigator.userAgent.toLowerCase().match(a)):null!==navigator.userAgent.toLowerCase().match(/msie/i)};var g=window.console=window.console||{log:function(){}};
a.log=function(){var c=Array.prototype.slice.call(arguments,0);"object"===a.typeOf(g.log)?g.log(c):g.log.apply(g,c)}})(chatease);
(function(b){function a(){var a=document.createElement("style");a.type="text/css";document.getElementsByTagName("head")[0].appendChild(a);return a.sheet||a.styleSheet}var g=b.utils,c;(g.css=function(d,e){c||(c=a());var b="";g.foreach(e,function(a,c){b+=a+": "+c+"; "});try{c.insertRule?c.insertRule(d+" { "+b+"}",c.cssRules.length):c.addRule(d,b,c.rules.length)}catch(f){g.log("Failed to insert css rule: "+d)}}).style=function(a,c,b){if(void 0!==a&&null!==a)for(void 0===a.length&&(a=[a]),c=g.extend({},
c),b=0;b<a.length;b++){var e=a[b];void 0!==e&&null!==e&&g.foreach(c,function(a,c){a=a.split("-");for(var b=1;b<a.length;b++)a[b]=a[b].charAt(0).toUpperCase()+a[b].slice(1);a=a.join("");e.style[a]!==c&&(e.style[a]=c)})}}})(chatease);(function(b){var a=b.utils;a.filter=function(b){var c,d="";this.replace=function(a){return d&&c?a.replace(c,"**"):a};"string"==a.typeOf(b)&&b&&(d=b,c=new RegExp(d,"ig"))}})(chatease);
(function(b){b.events={ERROR:"error",CHATEASE_READY:"chateaseReady",CHATEASE_SETUP_ERROR:"chateaseSetupError",CHATEASE_RENDER_ERROR:"chateaseRenderError",CHATEASE_STATE:"chateaseState",CHATEASE_PROPERTY:"chateaseProperty",CHATEASE_CONNECT:"chateaseConnect",CHATEASE_INDENT:"chateaseIdent",CHATEASE_MESSAGE:"chateaseMessage",CHATEASE_JOIN:"chateaseJoin",CHATEASE_LEFT:"chateaseLeft",CHATEASE_USERS:"chateaseUsers",CHATEASE_CLOSE:"chateaseClose",CHATEASE_VIEW_SEND:"chateaseViewSend",CHATEASE_VIEW_PROPERTY:"chateaseViewProperty",
CHATEASE_VIEW_CLEARSCREEN:"chateaseViewClearScreen",CHATEASE_VIEW_NICKCLICK:"chateaseViewNickClick"}})(chatease);
(function(b){var a=b.utils;b.events.eventdispatcher=function(g){function c(c,b,e){if(c)for(var d=0;d<c.length;d++){var h=c[d];if(h){null!==h.count&&0===--h.count&&delete c[d];try{h.listener(b)}catch(q){a.log('Error handling "'+e+'" event listener ['+d+"]: "+q.toString(),h.listener,b)}}}}var d={},e=[];this.addEventListener=function(c,b,e){try{a.exists(d[c])||(d[c]=[]),"string"===a.typeOf(b)&&(b=(new Function("return "+b))()),d[c].push({listener:b,count:e||null})}catch(u){a.log("error",u)}return!1};
this.removeEventListener=function(c,b){if(d[c]){try{if(void 0===b){d[c]=[];return}var e;for(e=0;e<d[c].length;e++)if(d[c][e].listener.toString()===b.toString()){d[c].splice(e,1);break}}catch(u){a.log("error",u)}return!1}};this.addGlobalListener=function(c,b){try{"string"===a.typeOf(c)&&(c=(new Function("return "+c))()),e.push({listener:c,count:b||null})}catch(k){a.log("error",k)}return!1};this.removeGlobalListener=function(c){if(c){try{var b;for(b=e.length-1;0<=b;b--)e[b].listener.toString()===c.toString()&&
e.splice(b,1)}catch(k){a.log("error",k)}return!1}};this.dispatchEvent=function(m,f){f||(f={});a.extend(f,{id:g,version:b.version,type:m});b.debug&&a.log(m,f);c(d[m],f,m);c(e,f,m)}}})(chatease);
(function(b){var a=b.utils,g=b.events,c={},d={onError:g.ERROR,onReady:g.CHATEASE_READY,onConnect:g.CHATEASE_CONNECT,onIdent:g.CHATEASE_INDENT,onMessage:g.CHATEASE_MESSAGE,onJoin:g.CHATEASE_JOIN,onLeft:g.CHATEASE_LEFT,onUsers:g.CHATEASE_USERS,onNickClick:g.CHATEASE_VIEW_NICKCLICK,onClose:g.CHATEASE_CLOSE};b.api=function(c){function e(a){f.dispatchEvent(a.type,a)}var f=a.extend(this,new g.eventdispatcher("api")),k;f.container=c;f.id=c.id;f.setup=function(c){a.emptyElement(f.container);b.debug=!!c.debug;
f.config=c;f.config.id=f.id;f.embedder=new b.embed(f);f.embedder.addGlobalListener(e);f.embedder.embed();return f};f.setEntity=function(a,c){k=a;f.onSWFLoaded=k.setup;f.onSWFOpen=k.onSWFOpen;f.onSWFMessage=k.onSWFMessage;f.onSWFError=k.onSWFError;f.onSWFClose=k.onSWFClose;f.send=k.send;f.resize=k.resize};(function(){a.foreach(d,function(a,c){f[a]=function(a){f.addEventListener(c,a)}})})()};b.api.getInstance=function(e){var d;null==e?e=0:e.nodeType?d=e:"string"===a.typeOf(e)&&(d=document.getElementById(e));
if(d){var g=c[d.id];g||(c[e]=g=new b.api(d));return g}return"number"===a.typeOf(e)?c[e]:null};b.api.displayError=function(a,c){}})(chatease);(function(b){b.core={}})(chatease);(function(b){b.core.states={CONNECTED:"connected",CLOSED:"closed",ERROR:"error"}})(chatease);
(function(b){b.core.protocol={};b=b.core.protocol;b.cmds={TEXT:"text",MUTE:"mute",KICKOUT:"kickout",PING:"ping"};b.raws={IDENT:"ident",TEXT:"text",JOIN:"join",LEFT:"left",USERS:"users",MUTE:"mute",KICKOUT:"kickout",ERROR:"error",PONG:"pong"};b.roles={VISITOR:0,NORMAL:1,VIP:14,ASSISTANT:16,SECRETARY:32,ANCHOR:48,ADMIN:64,SU_ADMIN:128,SYSTEM:192};b.channelStates={NORMAL:0,MUTED:1,LOCKED:3};b.punishments={MUTED:1,KICKED_OUT:3};b.errors={BAD_REQUEST:400,UNAUTHORIZED:401,FORBIDDED:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,
REQUEST_TIMEOUT:408,CONFLICT:409,INTERNAL_SERVER_ERROR:500,NOT_IMPLEMENTED:501,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504}})(chatease);(function(b){b.core.skins={}})(chatease);(function(b){b.core.skins.modes={DEFAULT:"def"}})(chatease);
(function(b){var a=b.utils,g=b.events;b=b.core.skins;var c=b.modes,d=a.css,e="cha-skin";b.def=function(b){var f=a.extend(this,new g.eventdispatcher("skins.def"));f.resize=function(a,c){a=document.getElementById(f.config.id);c=document.getElementById(f.config.id+"-console");var b=document.getElementById(f.config.id+"-input");d.style(c,{height:a.clientHeight-140+"px"});d.style(b,{width:a.clientWidth-96+"px"})};f.name=c.DEFAULT;f.config=a.extend({},b);e+="-"+f.name;d(".cha-wrapper",{width:"100%",height:"100%"});
d(".cha-wrapper *",{margin:"0",padding:"0","font-family":"Microsoft YaHei,arial,sans-serif","font-size":"14px","font-weight":"normal","box-sizing":"content-box"});d("."+e+" .cha-checkbox",{padding:"6px 0 6px 18px",color:"#E6E6E6","background-repeat":"no-repeat","background-position":"left center",cursor:"pointer",overflow:"hidden"});d("."+e+" .cha-button",{padding:"6px 14px","font-style":"normal","font-weight":"normal","text-align":"center","text-transform":"uppercase","white-space":"nowrap","word-spacing":"normal",
border:"none","border-radius":"2px",cursor:"pointer",display:"inline-block","-webkit-font-smoothing":"subpixel-antialiased","-moz-osx-font-smoothing":"grayscale",transition:"150ms ease-in-out","transition-property":"background-color, color"});d("."+e+" .cha-button.red",{color:"#FFFFFF","background-color":"#FF0046"});d("."+e+" .cha-button.red:hover",{"background-color":"#97052D"});d("."+e+" .cha-render",{width:"100%",height:"100%"});d("."+e+" .cha-render .cha-title",{width:"100%",height:"40px","font-family":"inherit",
"font-weight":"normal","text-align":"center","line-height":"40px",color:"#E6E6E6","background-color":"#171717",cursor:"default","pointer-events":"none"});d("."+e+" .cha-render .cha-console",{height:f.config.height-140+"px",color:"#242424","background-color":"#F8F8F8","overflow-y":"scroll"});d("."+e+" .cha-render .cha-console > div",{margin:"6px","word-break":"break-all","word-wrap":"break-word"});d("."+e+" .cha-render .cha-console > div.cha-system, ."+e+" .cha-render .cha-console > div.cha-system > a",
{"font-style":"normal","font-weight":"normal",color:"#33CC00",cursor:"default","pointer-events":"none"});d("."+e+" .cha-render .cha-console > div > span.ico-visitor",{"margin-right":"6px"});d("."+e+" .cha-render .cha-console > div > span.ico-normal",{"margin-right":"6px"});d("."+e+" .cha-render .cha-console > div > a",{color:"#3C9CFE","text-decoration":"none",cursor:"pointer"});d("."+e+" .cha-render .cha-controls",{width:"100%",height:"40px","line-height":"100%","background-color":"#171717",overflow:"hidden"});
d("."+e+" .cha-render .cha-controls > *",{margin:"6px 0","text-align":"center",display:"block"});d("."+e+" .cha-render .cha-controls > .cha-checkbox",{"background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOAgMAAABiJsVCAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAJUExURUxpcebm5ubm5kbBEu0AAAACdFJOUwCgoEVu0AAAABpJREFUCNdjYAABqVWrHBi0Vq1qII0AawMBACnPF0kf/g8sAAAAAElFTkSuQmCC)"});d("."+e+" .cha-render .cha-controls > .cha-checkbox[checked=true]",{"background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAA40lEQVQ4T52SvXHCQBCF3wuUKDHp7QXYFZgOrBKgAqADOsDuRK7ALoEOGDqwk1UoSHSBZrTMMWhGY358w0YbvG9/3i7xYDByqloCmKfUMLPSe7/sQUuADmfNk4gwCTSzXZZli7ZtS5KvSWCE8jwvmqZZkVzHrv+CPRRCKAB89etcA38BjM+CA8lJzLuu25Ic3QJ/RORl4PBMRL5VdQPgbWjeRUcz+/Dev1dVVTjnNqo6HY54b1SQXDrnyrquRyGELYDnv6e6Z87MzCa9i8mgme2jeGjIrR2TXw7Ap4gsTp/zSBwBq1l6D5ci9L8AAAAASUVORK5CYII=)"});
d("."+e+" .cha-render .cha-controls .shieldtext",{"float":"left"});d("."+e+" .cha-render .cha-controls .clearscreen",{"float":"right",width:"42px"});d("."+e+" .cha-render .cha-dialog",{width:"100%",height:"60px",overflow:"hidden"});d("."+e+" .cha-render .cha-dialog textarea",{padding:"6px 10px",width:f.config.width-124+"px",height:"48px",resize:"none",border:"0 none","background-color":"#E6E6E6"});d("."+e+" .cha-render .cha-dialog button",{"float":"right",width:"42px",height:"48px"})}})(chatease);
(function(b){b.core.renders={}})(chatease);(function(b){b.core.renders.modes={DEFAULT:"def"}})(chatease);
(function(b){var a=b.utils,g=b.events;b=b.core;var c=b.protocol.roles;b=b.renders;var d=b.modes;b.def=function(b,m){function e(c,b,d,e,g){var f=a.createElement("div",b);f.setAttribute("checked",!!g);f.innerHTML=c;c=function(c,b){return function(d){d="true"==f.getAttribute("checked")?!1:!0;f.setAttribute("checked",d);h.dispatchEvent(c,a.extend({value:d},b))}}(d,e);try{f.addEventListener("click",c)}catch(B){f.attachEvent("onclick",c)}return f}function k(c,b,d,e){b=a.createElement("div",b);var g=a.createElement("a");
b.appendChild(g);g.innerHTML=c;c=function(a,c){return function(b){h.dispatchEvent(a,c)}}(d,e);try{g.addEventListener("click",c)}catch(z){g.attachEvent("onclick",c)}return b}function u(b){var d="";return"number"!=a.typeOf(b)&&(b=parseInt(b),NaN==b||0>b)?"":d=b&c.SYSTEM?(b&c.SYSTEM)==c.SYSTEM?d+"ico-system":b&c.SU_ADMIN?d+"ico-suadmin":d+"ico-admin":b&c.ANCHOR?(b&c.ANCHOR)==c.ANCHOR?d+"ico-anchor":b&c.SECRETARY?d+"ico-secretary":d+"ico-assistant":b&c.VIP?d+("ico-vip"+((b&c.VIP)-1)):(b&c.NORMAL)==c.NORMAL?
d+"ico-normal":d+"ico-visitor"}var h=a.extend(this,new g.eventdispatcher("renders.def")),q,p,v,w,l,t;h.setup=function(){a.isMSIE(8)||a.isMSIE(9)?_object.setup&&(h.config.debug=!1,_object.setup(h.config),h.dispatchEvent(g.CHATEASE_READY,{id:h.config.id})):h.dispatchEvent(g.CHATEASE_READY,{id:h.config.id})};h.show=function(b,d,e){"object"!=a.typeOf(d)&&(d={id:0,name:"\u7cfb\u7edf",role:c.SYSTEM});"uni"!=e&&(e="multi");var f=a.createElement("div");d.role&c.SYSTEM&&(f.className="cha-system");"uni"==e&&
(e=a.createElement("span"),e.innerHTML="[\u5bc6\u8bed]",f.appendChild(e));if(e=u(d.role))e=a.createElement("span",e),f.appendChild(e);e=a.createElement("a");e.innerHTML=d.name+"\uff1a";d=function(a){return function(b){h.dispatchEvent(g.CHATEASE_VIEW_NICKCLICK,{user:a})}}(d);try{e.addEventListener("click",d)}catch(y){e.attachEvent("onclick",d)}f.appendChild(e);f.insertAdjacentHTML("beforeend",b);p.childNodes.length>=h.config.maxrecords&&p.removeChild(p.childNodes[0]);p.appendChild(f);p.scrollTop=p.scrollHeight};
h.send=function(){h.dispatchEvent(g.CHATEASE_VIEW_SEND,{data:{data:l.value,type:"multi"}});h.clearInput()};h.clearInput=function(){l.value=""};h.clearScreen=function(){a.emptyElement(p)};h.element=function(){return _object};h.resize=function(a,b){};h.destroy=function(){};h.name=d.DEFAULT;h.config=a.extend({},{},m);if(a.isMSIE(8)||a.isMSIE(9))b.innerHTML='<object id="cha-swf" name="cha-swf" align="middle" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"><param name="movie" value="'+h.config.swf+
'"><param name="quality" value="high"><param name="bgcolor" value="#ffffff"><param name="allowscriptaccess" value="sameDomain"><param name="allowfullscreen" value="true"><param name="wmode" value="transparent"><param name="FlashVars" value="id='+h.config.id+'"></object>',_object=h.WebSocket=b.firstChild,_object.style.width=_object.style.height="0";(function(){q=a.createElement("div","cha-title");b.appendChild(q);q.innerHTML="\u804a\u5929\u5ba4";p=a.createElement("div","cha-console");p.id=h.config.id+
"-console";b.appendChild(p);v=a.createElement("div","cha-controls");b.appendChild(v);var c=e("\u5c4f\u853d\u6d88\u606f","cha-checkbox shieldtext",g.CHATEASE_VIEW_PROPERTY,{key:"shield"},!1);v.appendChild(c);c=k("\u6e05\u5c4f","cha-button red clearscreen",g.CHATEASE_VIEW_CLEARSCREEN,null);v.appendChild(c);w=a.createElement("div","cha-dialog");b.appendChild(w);l=a.createElement("textarea");l.id=h.config.id+"-input";w.appendChild(l);t=a.createElement("button","cha-button red");w.appendChild(t);l.setAttribute("placeholder",
"\u8f93\u5165\u804a\u5929\u5185\u5bb9");h.config.maxlength&&l.setAttribute("maxlength",h.config.maxlength);c=function(){return function(a){a=window.event||a;13==a.keyCode&&(a.ctrlKey?l.value+="\r\n":(h.send(),window.event?a.returnValue=!1:a.preventDefault()))}}();try{l.addEventListener("keypress",c)}catch(n){l.attachEvent("onkeypress",c)}t.innerHTML="\u53d1\u9001";c=function(){return function(){h.send()}}();try{t.addEventListener("click",c)}catch(n){t.attachEvent("onclick",c)}})()}})(chatease);
(function(b){var a=b.utils,g=b.events,c=b.core;c.entity=function(b){var d=a.extend(this,new g.eventdispatcher("core.entity")),m,f,k;d.setup=function(){setTimeout(function(){k.setup()},0)};d.destroy=function(){k&&k.stop();f&&f.destroy();m&&m.destroy()};d.id=b.id;d.model=m=new c.model(b);d.view=f=new c.view(m);d.controller=k=new c.controller(m,f);k.addGlobalListener(function(a){d.dispatchEvent(a.type,a)});d.onSWFOpen=k.onOpen;d.onSWFMessage=k.onMessage;d.onSWFError=k.onError;d.onSWFClose=k.onClose;
d.send=k.send;d.getState=m.getState;d.resize=f.resize}})(chatease);
(function(b){var a=b.utils,g=b.events;b=b.core;var c=b.states,d=b.protocol,e=d.roles,m=d.channelStates,f=d.punishments,k=function(){var b=this;_interval=-1;_active=0;b.set=function(c){a.extend(b,c);1==c.hasOwnProperty("role")&&(c=c.role,_interval=0>c?-1:c>=e.ASSISTANT?0:c&e.VIP?500:c==e.NORMAL?1E3:2E3)};b.isMuted=function(){return!!(b.state&m.MUTED|b.punishment.code&f.MUTED)};b.isActive=function(){if(0>_interval)return!1;var a=(new Date).getTime();if(_active&&a-_active<_interval)return!1;_active=
a;return!0};a.extend(b,{channel:null,role:-1,state:0,punishment:{code:0,time:0}})};b.model=function(b){var d=a.extend(this,new g.eventdispatcher("core.model")),e=c.CLOSED,f;d.setState=function(a){a!==e&&(e=a,d.dispatchEvent(g.CHATEASE_STATE,{state:a}))};d.getState=function(){return e};d.setProperty=function(a,b){1==f.hasOwnProperty(a)&&(f[a]=b,d.dispatchEvent(g.CHATEASE_PROPERTY,{key:a,value:b}))};d.getProperty=function(a){return f[a]};d.getConfig=function(a){return d.config[a]};d.destroy=function(){};
d.config=a.extend({},{},b);f={userinfo:new k,shield:!1}}})(chatease);
(function(b){var a=b.utils,g=b.events;b=b.core;var c=b.protocol.roles,d=b.renders,e=b.skins;b.view=function(b){function f(a){if(a.ctrlKey||a.metaKey)return!0;switch(a.keyCode){case 13:l&&l.send()}if(/13|32/.test(a.keyCode))return a.preventDefault?a.preventDefault():a.returnValue=!1,!1}function k(a){}function m(a){h(a)}function h(a){q.dispatchEvent(a.type,a)}var q=a.extend(this,new g.eventdispatcher("core.view")),p,v,w,l,t;q.setup=function(){l?(l.setup(),q.resize()):q.dispatchEvent(g.CHATEASE_SETUP_ERROR,
{message:"Render not available!",name:b.config.render.name})};q.show=function(a,d,e){(!d||d.role&c.SYSTEM||!b.getProperty("shield"))&&l&&l.show(a,d,e)};q.resize=function(a,b){l&&l.resize(a,b);t&&t.resize(a,b)};q.destroy=function(){p&&p.removeEventListener("keydown",f);l&&l.destroy()};(function(){p=a.createElement("div","cha-wrapper cha-skin-"+b.getConfig("skin").name);p.id=b.getConfig("id");p.tabIndex=0;v=a.createElement("div","cha-render");w=a.createElement("div","cha-contextmenu");p.appendChild(v);
p.appendChild(w);var c=a.extend({},b.getConfig("render"),{id:b.getConfig("id"),url:b.getConfig("url"),width:b.getConfig("width"),height:b.getConfig("height"),maxlength:b.getConfig("maxlength"),maxrecords:b.getConfig("maxrecords")});try{l=q.render=new d[c.name](v,c),l.addEventListener(g.CHATEASE_READY,h),l.addEventListener(g.CHATEASE_VIEW_SEND,h),l.addEventListener(g.CHATEASE_VIEW_PROPERTY,h),l.addEventListener(g.CHATEASE_VIEW_CLEARSCREEN,h),l.addEventListener(g.CHATEASE_VIEW_NICKCLICK,h),l.addEventListener(g.CHATEASE_RENDER_ERROR,
m)}catch(n){a.log("Failed to init render "+c.name+"!")}c=a.extend({},b.getConfig("skin"),{id:b.getConfig("id"),width:b.config.width,height:b.config.height});try{t=new e[c.name](c)}catch(n){a.log("Failed to init skin "+c.name+"!")}c=document.getElementById(b.getConfig("id"));c.parentNode.replaceChild(p,c);try{p.addEventListener("keydown",f),window.addEventListener("resize",k)}catch(n){p.attachEvent("onkeydown",f),window.attachEvent("onresize",k)}})()}})(chatease);
(function(b){var a=b.utils,g=b.events;b=b.core;var c=b.states,d=b.protocol,e=d.cmds,m=d.raws,f=d.roles,k=d.channelStates,u=d.punishments,h=d.errors;b.controller=function(b,d){function p(){if(r&&b.getState()==c.CONNECTED)a.log("Websocket had connected already.");else{d.show("\u804a\u5929\u5ba4\u8fde\u63a5\u4e2d\u2026");try{window.WebSocket=window.WebSocket||window.MozWebSocket,window.WebSocket?(r||(r=new WebSocket(b.config.url)),r.onopen=n.onOpen,r.onmessage=n.onMessage,r.onerror=n.onError,r.onclose=
n.onClose):(r=d.render.WebSocket,r.connect())}catch(B){a.log("Failed to initialize websocket: "+B)}}}function q(b){var c="";if("number"!=a.typeOf(b)&&(b=parseInt(b),NaN==b||0>b))return"";b&f.SYSTEM?c=(b&f.SYSTEM)==f.SYSTEM?c+"[\u7cfb\u7edf]":b&f.SU_ADMIN?c+"[\u8d85\u7ba1]":c+"[\u7ba1\u7406\u5458]":b&f.ANCHOR?c=(b&f.ANCHOR)==f.ANCHOR?c+"[\u4e3b\u64ad]":b&f.SECRETARY?c+"[\u52a9\u7406]":c+"[\u623f\u7ba1]":b&f.VIP?c+="[VIP"+((b&f.VIP)-1)+"]":(b&f.NORMAL)!=f.NORMAL&&(c+="[\u6e38\u5ba2]");return c}function l(b,
c){var e=t(b);e&&d.show(e);var f={raw:"error",error:{code:b,explain:e}};a.foreach(c,function(b,a){"cmd"!=b&&"raw"!=b&&"error"!=b&&(f[b]=a)});n.dispatchEvent(g.ERROR,f)}function t(b){var a="";switch(b){case h.BAD_REQUEST:a="\u9519\u8bef\u8bf7\u6c42\uff01";break;case h.UNAUTHORIZED:a="\u8bf7\u5148\u767b\u5f55\uff01";break;case h.FORBIDDED:a="\u6743\u9650\u9519\u8bef\uff01";break;case h.NOT_FOUND:a="\u672a\u77e5\u8bf7\u6c42\uff01";break;case h.CONFLICT:a="\u64cd\u4f5c\u9891\u7e41\uff01";break;case h.INTERNAL_SERVER_ERROR:a=
"\u5185\u90e8\u9519\u8bef\uff01";break;case h.NOT_IMPLEMENTED:a="\u65e0\u6cd5\u8bc6\u522b\uff01";break;case h.BAD_GATEWAY:a="\u54cd\u5e94\u65e0\u6548\uff01";break;case h.SERVICE_UNAVAILABLE:a="\u670d\u52a1\u8fc7\u8f7d\uff01";break;case h.GATEWAY_TIMEOUT:a="\u7f51\u5173\u8d85\u65f6\uff01"}return a}function x(b){n.dispatchEvent(b.type,b)}var n=a.extend(this,new g.eventdispatcher("core.controller")),A=!1,r,y,z=0;n.setup=function(b){A||d.setup()};n.send=function(d){if(r&&b.getState()==c.CONNECTED)if("object"!=
a.typeOf(d)||0==d.hasOwnProperty("cmd"))l(h.BAD_REQUEST,d);else{var e=b.getProperty("userinfo");0==e.isActive()?l(h.CONFLICT,d):1==e.isMuted()?l(h.FORBIDDED,d):r.send(JSON.stringify(d))}else p()};n.onOpen=function(a){b.setState(c.CONNECTED)};n.onMessage=function(c){var e;try{e=eval("("+c.data+")")}catch(C){a.log("Failed to parse JSON. \nError: "+C+"\ndata: "+c.data);return}switch(e.raw){case m.IDENT:c=b.getProperty("userinfo");c.set(a.extend({},e.user,{channel:e.channel.id,state:e.channel.state}));
d.show("\u5df2\u52a0\u5165\u623f\u95f4\uff08"+c.channel+"\uff09\u3002");c.state&k.MUTED&&d.show("\u60a8\u6240\u5728\u7684\u7528\u6237\u7ec4\u4e0d\u80fd\u53d1\u8a00\uff01");if(c.punishment.code&u.MUTED){var f=new Date;f.setTime(c.punishment.time);d.show("\u60a8\u5df2\u88ab\u7981\u8a00\u81f3\uff08"+a.formatTime(f)+"\uff09\uff01")}n.dispatchEvent(g.CHATEASE_INDENT,e);break;case m.TEXT:try{y||(y=new a.filter(b.keywords)),e.data=y.replace(e.data)}catch(C){a.log("Failed to execute filter.")}d.show(e.data,
e.user,e.type);n.dispatchEvent(g.CHATEASE_MESSAGE,e);break;case m.JOIN:c=q(e.user.role);d.show((c?c+" ":"")+e.user.name+" \u8fdb\u5165\u623f\u95f4\u3002");n.dispatchEvent(g.CHATEASE_JOIN,e);break;case m.LEFT:c=q(e.user.role);d.show((c?c+" ":"")+e.user.name+" \u5df2\u79bb\u5f00\u3002");n.dispatchEvent(g.CHATEASE_LEFT,e);break;case m.USERS:n.dispatchEvent(g.CHATEASE_USERS,e);break;case m.ERROR:l(e.error.code,e);break;default:a.log("Unknown data type: "+e.raw+", ignored.")}};n.onError=function(a){b.setState(c.ERROR)};
n.onClose=function(a){b.setState(c.CLOSED)};n.close=function(){r&&r.close()};b.addEventListener(g.CHATEASE_STATE,function(a){switch(a.state){case c.CONNECTED:d.show("\u804a\u5929\u5ba4\u5df2\u8fde\u63a5\u2026");z=0;n.dispatchEvent(g.CHATEASE_CONNECT);break;case c.CLOSED:d.show("\u804a\u5929\u5ba4\u8fde\u63a5\u5df2\u65ad\u5f00\uff01");n.dispatchEvent(g.CHATEASE_CLOSE,{channel:{id:b.channel}});if(0>b.config.maxretries||z<b.config.maxretries)a=Math.ceil(b.config.retrydelay+5E3*Math.random()),d.show("\u6b63\u5728\u51c6\u5907\u91cd\u8fde\uff0c"+
a/1E3+"\u79d2..."),z++,r=null,setTimeout(p,a);break;case c.ERROR:d.show("\u804a\u5929\u5ba4\u5f02\u5e38\uff01");n.dispatchEvent(g.ERROR,{message:"Chat room error!",channel:{id:b.channel}});break;default:n.dispatchEvent(g.ERROR,{message:"Unknown model state!",state:a.state})}});b.addEventListener(g.CHATEASE_PROPERTY,function(b){x(b)});d.addEventListener(g.CHATEASE_READY,function(c){A||(a.log("Chat ready!"),A=!0,x(c),p(),window.onbeforeunload=function(a){r&&b.getState()})});d.addEventListener(g.CHATEASE_SETUP_ERROR,
function(a){b.setState(c.ERROR);x(a)});d.addEventListener(g.CHATEASE_VIEW_SEND,function(c){var f=c.data.data;if(f){0<=b.config.maxlength&&(f=f.substr(0,b.config.maxlength));var f=a.trim(f),g=b.getProperty("userinfo");n.send({cmd:e.TEXT,data:f,type:c.data.type,channel:{id:g.channel}})}else d.show("\u8bf7\u8f93\u5165\u5185\u5bb9\uff01")});d.addEventListener(g.CHATEASE_VIEW_PROPERTY,function(a){b.setProperty(a.key,a.value)});d.addEventListener(g.CHATEASE_VIEW_CLEARSCREEN,function(a){d.render.clearScreen();
x(a)});d.addEventListener(g.CHATEASE_VIEW_NICKCLICK,function(a){var c=b.getProperty("userinfo");a.channel={id:c.channel,state:c.state};x(a)});d.addEventListener(g.CHATEASE_RENDER_ERROR,function(a){b.setState(c.ERROR);x(a)})}})(chatease);
(function(b){var a=b.utils,g=b.events,c=b.embed=function(d){function e(a){switch(a.type){case g.ERROR:case g.CHATEASE_SETUP_ERROR:case g.CHATEASE_RENDER_ERROR:m.errorScreen(a.message);m.dispatchEvent(g.ERROR,a);break;default:m.dispatchEvent(a.type,a)}}var m=a.extend(this,new g.eventdispatcher("embed")),f={},k=null,u=!1;m.embed=function(){try{f=new c.config(d.config),k=new c.embedder(d,f)}catch(h){a.log("Failed to init embedder!");m.dispatchEvent(g.CHATEASE_SETUP_ERROR,{message:"Failed to init embedder!",
render:f.render.name});return}k.addGlobalListener(e);k.embed()};m.errorScreen=function(a){u||(u=!0,b.api.displayError(a,f))};(function(){a.foreach(d.config.events,function(b,c){b=d[b];"function"===a.typeOf(b)&&b.call(d,c)})})()}})(chatease);
(function(b){var a=b.utils,g=b.embed,c=b.core.renders.modes,d=b.core.skins.modes;g.config=function(b){return a.extend({},{url:"ws://"+window.location.host+"/ch1?token=123456",width:640,height:400,keywords:"",maxlength:30,maxrecords:50,maxretries:-1,retrydelay:3E3,render:{name:c.DEFAULT,swf:"swf/chatease.swf"},skin:{name:d.DEFAULT}},b)};g.config.addConfig=function(b,c){return a.extend(b,c)}})(chatease);
(function(b){var a=b.utils,g=b.events,c=b.core;b.embed.embedder=function(b,e){function d(a){f.dispatchEvent(a.type,a)}var f=a.extend(this,new g.eventdispatcher("embed.embedder"));f.embed=function(){var a=new c.entity(e);a.addGlobalListener(d);a.setup();b.setEntity(a,e.render.name)}}})(chatease);